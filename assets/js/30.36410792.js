(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{397:function(a,t,e){"use strict";e.r(t);var s=e(42),l=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("一般情况下我们创建的集合是没有大小的，可以一直往里边添加文档，这种集合可以动态增长，MongoDB 中还有一种集合叫做固定集合，这种集合的大小是固定的，我可以在创建的时候设置该集合中文档的数目，假设为 100 条，当集合中的文档数目达到 100 条时，如果再向集合中插入文档，则只会保留最新的 100 个文档，之前的文档则会被删除。")]),a._v(" "),e("p",[a._v("一般像日志信息我们就可以使用固定集合，其他一些需要定期删除的数据也可以使用固定集合，本文我们就来看看这个固定集合的使用。")]),a._v(" "),e("h2",{attrs:{id:"创建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[a._v("#")]),a._v(" 创建")]),a._v(" "),e("p",[a._v("固定集合的创建方式也比较简单，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('db.createCollection("my_collect",{capped:true,size:10000,max:100})\n')])])]),e("p",[a._v("capped:true 参数表示该集合为一个固定大小集合，size 表示集合的大小，单位为 kb，max 则表示集合中文档的最大数量。我们这里相当于给了固定集合两个限制条件，只要有任意一个限制条件满足，集合都会开始将更古老的数据删除。固定集合一旦创建成功就不能再修改，想修改只能删除重来。此时我们可以尝试向集合中添加 120 条简单的数据，然后我们会发现最早的 20 条数据消失了。")]),a._v(" "),e("p",[a._v("除了直接创建一个固定集合外，我们也可以通过 convertToCapped 操作将一个普通集合转为一个固定集合，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('db.runCommand({convertToCapped:"sang_collect",size:10})\n')])])]),e("h2",{attrs:{id:"自然排序问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自然排序问题"}},[a._v("#")]),a._v(" 自然排序问题")]),a._v(" "),e("p",[a._v("自然排序就是按照文档在磁盘中的顺序来进行排列，在普通的集合中自然排序并没有多大的意义，因为文档的位置总是在变化，而固定集合中的文档是按照文档被插入的顺序保存的，自然顺序也就是文档的插入顺序，因此我们可以利用自然排序对文档从旧到新排序，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("db.sang_collect.find().sort({$natural:1})\n")])])]),e("p",[a._v("也可以从新到旧排序：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("db.sang_collect.find().sort({$natural:-1})\n")])])]),e("p",[a._v("固定集合中的其他操作和普通集合基本一致，这里就不再赘述。")]),a._v(" "),e("p",[a._v("好了，MongoDB 中的固定集合我们就说到这里，小伙伴们有问题欢迎留言讨论。")]),a._v(" "),e("p",[a._v("参考资料：")]),a._v(" "),e("ol",[e("li",[a._v("《MongoDB权威指南第2版》")])])])}),[],!1,null,null,null);t.default=l.exports}}]);
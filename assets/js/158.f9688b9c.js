(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{469:function(t,n,a){"use strict";a.r(n);var s=a(42),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("前两天松哥发了一篇文章，和大家仔细的过了一遍 Spring Security 的登录流程：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/z6GeR5O-vBzY3SHehmccVA",target:"_blank",rel:"noopener noreferrer"}},[t._v("松哥手把手带你捋一遍 Spring Security 登录流程"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("在这篇文章中，我和大家详细分享了 Spring Security 的登录流程，在登录成功的最后一步，进入到 successfulAuthentication 回调中，在该回调方法中，小伙伴们看到了用户信息的保存位置：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContextHolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAuthentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("authResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("这样一行简单的保存代码，至少带给我们两方面的信息：")]),t._v(" "),a("ol",[a("li",[t._v("以后在任何地方，只要想获取用户信息，只需要调用 "),a("code",[t._v("SecurityContextHolder.getContext().getAuthentication()")]),t._v(" 就可以获取到。")]),t._v(" "),a("li",[t._v("以后在任何地方，只要想更新用户信息，只要调用 "),a("code",[t._v("SecurityContextHolder.getContext().setAuthentication(authResult);")]),t._v(" 就可以更新。")])]),t._v(" "),a("h2",{attrs:{id:"_1-获取用户登录信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-获取用户登录信息"}},[t._v("#")]),t._v(" 1.获取用户登录信息")]),t._v(" "),a("p",[t._v("用户信息的获取，其实办法很多，上面提到的 "),a("code",[t._v("SecurityContextHolder.getContext().getAuthentication()")]),t._v(" 是一个静态方法，也就是利用这个方法，我们可以随时随地拿到用户信息（需要注意 ThreadLocal 的限制）。")]),t._v(" "),a("p",[t._v("除了这种方式之外，我们也可以在 Controller 中的方法上，直接就可以注入 Authentication 对象，进而获取到当前用户信息，像下面这样：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hr/info"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentHr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Authentication")]),t._v(" authentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" authentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPrincipal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("当然，关于用户信息获取的方式之前已经和大家聊过了，这里我就不再赘述，如果对如何获取 Spring Security 中用户信息还不熟悉，大家可以参考松哥之前的文章："),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/z6GeR5O-vBzY3SHehmccVA",target:"_blank",rel:"noopener noreferrer"}},[t._v("松哥手把手带你捋一遍 Spring Security 登录流程"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("今天主要是想和大家聊一下如何修改用户信息。")]),t._v(" "),a("h2",{attrs:{id:"_2-修改用户登录信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改用户登录信息"}},[t._v("#")]),t._v(" 2.修改用户登录信息")]),t._v(" "),a("p",[t._v("在 Spring Security 中，当用户登录成功之后，如果前端提供了修改用户信息的功能，在前端修改完用户信息之后，存储在 Spring Security 中的用户信息也要及时修改，以防止在后面其他的请求中获取到错误的用户信息，Spring Security 中用户信息要如何修改呢？")]),t._v(" "),a("p",[t._v("一起来看大屏幕：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/jQZx4i4-vqjpBjpoJKJF4A",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频地址"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("好了，不知道小伙伴们有没有 GET 到呢？有问题欢迎留言讨论。")])])}),[],!1,null,null,null);n.default=e.exports}}]);
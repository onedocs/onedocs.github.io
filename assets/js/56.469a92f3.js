(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{420:function(a,s,t){"use strict";t.r(s);var e=t(42),v=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("上篇文章和大家聊了 CentOS7 安装 MySQL5.7 ，这个大家一般装在虚拟机里边，装好了，把虚拟拷贝一份，这样我们就有两个 MySQL ，就可以开始今天的主从搭建了。")]),a._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[a._v("#")]),a._v(" 准备工作")]),a._v(" "),t("p",[a._v("我这里有一张简单的图向大伙展示 MySQL 主从的工作方式：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://www.javaboy.org/images/mysql/3-1.png",alt:""}})]),a._v(" "),t("p",[a._v("这里，我们准备两台机器：")]),a._v(" "),t("ul",[t("li",[a._v("主机：192.168.248.128")]),a._v(" "),t("li",[a._v("从机：192.168.248.139")])]),a._v(" "),t("h2",{attrs:{id:"主机配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机配置"}},[a._v("#")]),a._v(" 主机配置")]),a._v(" "),t("p",[a._v("主机的配置就三个步骤，比较容易：")]),a._v(" "),t("p",[a._v("1.授权给从机服务器")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("GRANT REPLICATION SLAVE ON *.* to 'rep1'@'192.168.248.139' identified by '123';\nFLUSH PRIVILEGES;\n")])])]),t("p",[a._v("这里表示配置从机登录用户名为 rep1，密码为 123，并且必须从 192.168.248.139这个地址登录，登录成功之后可以操作任意库中的任意表。其中，如果不需要限制登录地址，可以将 IP 地址更换为一个 "),t("code",[a._v("%")]),a._v("。")]),a._v(" "),t("p",[a._v("2.修改主库配置文件，开启 binlog ，并设置 server-id ，每次修改配置文件后都要重启 MySQL 服务才会生效")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi /etc/my.cnf\n")])])]),t("p",[a._v("修改的文件内容如下：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[mysqld]\nlog-bin=/var/lib/mysql/binlog\nserver-id=128\nbinlog-do-db = cmdb\n")])])]),t("p",[a._v("如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://www.javaboy.org/images/mysql/3-2.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("log-bin：同步的日志路径及文件名，一定注意这个目录要是 MySQL 有权限写入的（我这里是偷懒了，直接放在了下面那个datadir下面）。")]),a._v(" "),t("li",[a._v("binlog-do-db：要同步的数据库名，当从机连上主机后，只有这里配置的数据库才会被同步，其他的不会被同步。")]),a._v(" "),t("li",[a._v("server-id: MySQL 在主从环境下的唯一标志符，给个任意数字，注意不能和从机重复。")])]),a._v(" "),t("p",[a._v("配置完成后重启 MySQL 服务端：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("systemctl restart mysqld\n")])])]),t("p",[a._v("3.查看主服务器当前二进制日志名和偏移量，这个操作的目的是为了在从数据库启动后，从这个点开始进行数据的恢复：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("show master status;\n")])])]),t("p",[t("img",{attrs:{src:"https://www.javaboy.org/images/mysql/3-3.png",alt:""}})]),a._v(" "),t("p",[a._v("至此，主机配置完成。")]),a._v(" "),t("h2",{attrs:{id:"从机配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从机配置"}},[a._v("#")]),a._v(" 从机配置")]),a._v(" "),t("p",[a._v("从机的配置也比较简单，我们一步一步来看：")]),a._v(" "),t("p",[a._v("1.在/etc/my.cnf 添加下面配置：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://www.javaboy.org/images/mysql/3-4.png",alt:""}})]),a._v(" "),t("p",[a._v("注意从机这里只需要配置一下 server-id 即可。")]),a._v(" "),t("p",[t("strong",[a._v("注意：如果从机是从主机复制来的，即我们通过复制 CentOS 虚拟机获取了 MySQL 实例 ，此时两个 MySQL 的 uuid 一样（正常安装是不会相同的），这时需要手动修改，修改位置在 "),t("code",[a._v("/var/lib/mysql/auto.cnf")]),a._v(" ，注意随便修改这里几个字符即可，但也不可太过于随意，例如修改了 uuid 的长度。")])]),a._v(" "),t("p",[a._v("2.使用命令来配置从机：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("change master to master_host='192.168.248.128',master_port=3306,master_user='rep1',master_password='123',master_log_file='binlog.000001',master_log_pos=120;\n")])])]),t("p",[a._v("这里配置了主机地址、端口以及从机登录主机的用户名和密码，注意最后两个参数要和 master 中的保持一致。")]),a._v(" "),t("p",[a._v("3.启动 slave 进程")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("start slave;\n")])])]),t("p",[a._v("启动之后查看从机状态：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("show slave status\\G;\n")])])]),t("p",[t("img",{attrs:{src:"https://www.javaboy.org/images/mysql/3-5.png",alt:""}})]),a._v(" "),t("p",[a._v("4.查看 slave 的状态")]),a._v(" "),t("p",[a._v("主要是下面两项值都要为为 YES，则表示配置正确：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("Slave_IO_Running: Yes\nSlave_SQL_Running: Yes\n")])])]),t("p",[a._v("至此，配置完成，主机创建库，添加数据，从机会自动同步。")]),a._v(" "),t("p",[a._v("如果这两个有一个不为 YES ，表示主从环境搭建失败，此时可以阅读日志，查看出错的原因，再具体问题具体解决。")]),a._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("p",[a._v("本文主要和大伙说了 MySQL 主从环境搭建，这几个步骤松哥反反复复操作过很多遍，小伙伴只要按照松哥的步骤一般来说都能成功，有问题欢迎留言讨论。")])])}),[],!1,null,null,null);s.default=v.exports}}]);